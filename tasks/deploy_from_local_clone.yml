---
- name: Clone locally before sync on host
  local_action: ansible.builtin.git repo={{ nodejsapp_repository_url }} dest={{ nodejsapp_src_path }} force=true
  become: false

- name: Deploy the nodejs app from a local repository
  synchronize:
    src: "{{ nodejsapp_src_path }}/"
    dest: "{{ nodejsapp_repository_dest }}"
    owner: no
    rsync_opts:
      - "--exclude=.git"
  register: deploy_app