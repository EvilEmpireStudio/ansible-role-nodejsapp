---
- name: Clone locally before sync on host
  local_action: ansible.builtin.shell rm -rf {{ nodejsapp_src_path }} || true; git clone {{ nodejsapp_repository_url }} {{ nodejsapp_src_path }}
  become: false

- name: Deploy the nodejs app from a local repository
  synchronize:
    src: "{{ nodejsapp_src_path }}/"
    dest: "{{ nodejsapp_repository_dest }}"
    owner: no
    rsync_opts:
      - "--exclude=.git"
  register: deploy_app